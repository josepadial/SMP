CCS PCH C Compiler, Version 5.008, 5967               17-may.-19 13:10

               Filename:   C:\Users\padul\Desktop\GitHub\SMP\sensor_ultrasonido\leer_distancia.lst

               ROM used:   358 bytes (1%)
                           Largest free fragment is 30358
               RAM used:   25 (1%) at main() level
                           26 (1%) worst case
               Stack used: 2 locations (1 in main + 1 for interrupts)
               Stack size: 31

*
0800:  GOTO   0926
*
0808:  MOVWF  04
080A:  MOVFF  FD8,05
080E:  MOVFF  FE0,06
0812:  MOVLB  0
0814:  MOVFF  FE9,0C
0818:  MOVFF  FEA,07
081C:  MOVFF  FE1,08
0820:  MOVFF  FE2,09
0824:  MOVFF  FD9,0A
0828:  MOVFF  FDA,0B
082C:  MOVFF  FF3,12
0830:  MOVFF  FF4,13
0834:  MOVFF  FFA,14
0838:  MOVFF  00,0E
083C:  MOVFF  01,0F
0840:  MOVFF  02,10
0844:  MOVFF  03,11
0848:  BTFSS  F9D.0
084A:  GOTO   0854
084E:  BTFSC  F9E.0
0850:  GOTO   08A2
0854:  BTFSS  FA0.0
0856:  GOTO   0860
085A:  BTFSC  FA1.0
085C:  GOTO   08B2
0860:  MOVFF  0E,00
0864:  MOVFF  0F,01
0868:  MOVFF  10,02
086C:  MOVFF  11,03
0870:  MOVFF  0C,FE9
0874:  MOVFF  07,FEA
0878:  BSF    07.7
087A:  MOVFF  08,FE1
087E:  MOVFF  09,FE2
0882:  MOVFF  0A,FD9
0886:  MOVFF  0B,FDA
088A:  MOVFF  12,FF3
088E:  MOVFF  13,FF4
0892:  MOVFF  14,FFA
0896:  MOVF   04,W
0898:  MOVFF  06,FE0
089C:  MOVFF  05,FD8
08A0:  RETFIE 0
.................... #include "tarjeta.h" 
.................... #ifndef _TARJETA_ 
.................... #define _TARJETA_ 
....................  
.................... #include <18F4550.h> 
.................... //////// Standard Header file for the PIC18F4550 device //////////////// 
.................... #device PIC18F4550 
....................  
.................... #list 
....................  
....................  
.................... #fuses USBDIV, CPUDIV1, PLL5, HSPLL, NOFCMEN, NOIESO, VREGEN, BORV21, BROWNOUT, NOPUT, WDT32768, NOWDT 
.................... #fuses MCLR, NOLPT1OSC, NOPBADEN, CCP2C1, NODEBUG, NOXINST, NOICPRT, NOLVP, STVREN, NOPROTECT, NOCPD 
.................... #fuses NOCPB, NOWRT, NOWRTD, WRTB, NOWRTC, NOEBTR, NOEBTRB 
....................  
.................... /*********************************************************** 
....................       EVITAMOS LA ZONA DE MEMORIA ASIGNADA AL MONITOR 
.................... ***********************************************************/ 
....................  
.................... #define LOADER_END   0x7FF 
.................... #define LOADER_SIZE   0x6FF 
....................  
.................... #build(reset=LOADER_END+1, interrupt=LOADER_END+9) 
.................... #org 0, LOADER_END {} 
.................... //#org 0x82A, 0x7FFF 
....................  
....................  
.................... /*********************************************************** 
....................            FUNCIONES PARA MOVER LOS MOTORES 
.................... MX_H() : Mueve el motor en sentido horario 
.................... MX_A() : Mueve el motor en sentido anti-horario 
.................... MX_P() : Para el motor 
.................... ***********************************************************/ 
....................  
.................... void M1_A(){ 
....................    output_high(PIN_A1); 
....................    output_high(PIN_D7); 
....................    output_low(PIN_D6); 
.................... } 
....................  
.................... void M1_H(){ 
....................    output_high(PIN_A1); 
....................    output_low(PIN_D7); 
....................    output_high(PIN_D6); 
.................... } 
....................  
.................... void M1_P(){ 
....................    output_high(PIN_A1); 
....................    output_low(PIN_D7); 
....................    output_low(PIN_D6); 
.................... } 
....................  
.................... void M2_A(){ 
....................    output_high(PIN_A0); 
....................    output_high(PIN_C2); 
....................    output_low(PIN_D5); 
.................... } 
....................  
.................... void M2_H(){ 
....................    output_high(PIN_A0); 
....................    output_low(PIN_C2); 
....................    output_high(PIN_D5); 
.................... } 
....................  
.................... void M2_P(){ 
....................    output_high(PIN_A0); 
....................    output_low(PIN_C2); 
....................    output_low(PIN_D5); 
.................... } 
....................  
.................... void M3_A(){ 
....................    output_high(PIN_A2); 
....................    output_low(PIN_B2); 
....................    output_high(PIN_E0); 
.................... } 
....................  
.................... void M3_H(){ 
....................    output_high(PIN_A2); 
....................    output_high(PIN_B2); 
....................    output_low(PIN_E0); 
.................... } 
....................  
.................... void M3_P(){ 
....................    output_high(PIN_A2); 
....................    output_low(PIN_B2); 
....................    output_low(PIN_E0); 
.................... } 
....................  
.................... void M4_A(){ 
....................    output_high(PIN_A3); 
....................    output_low(PIN_E2); 
....................    output_high(PIN_E1); 
.................... } 
....................  
.................... void M4_H(){ 
....................    output_high(PIN_A3); 
....................    output_high(PIN_E2); 
....................    output_low(PIN_E1); 
.................... } 
....................  
.................... void M4_P(){ 
....................    output_high(PIN_A3); 
....................    output_low(PIN_E2); 
....................    output_low(PIN_E1); 
.................... } 
....................  
....................  
.................... /*********************************************************** 
....................             MACRO PARA LEER EL PULSADOR P2 
.................... ***********************************************************/ 
....................  
.................... #define P2   (!input(PIN_B4)) 
....................  
.................... /*********************************************************** 
....................               MACROS PARA MANEJAR EL LED 
.................... ***********************************************************/ 
....................  
.................... #define led_on()   output_high(PIN_A5) 
.................... #define led_off()   output_low(PIN_A5) 
....................  
.................... /*********************************************************** 
....................            DEFINICION DE LAS E/S DIRECTAS 
.................... ***********************************************************/ 
....................  
.................... #define ES0   PIN_A4 
.................... #define ES1   PIN_B3 
.................... #define ES2   PIN_B5 
.................... #define ES3   PIN_B6 
.................... #define ES4   PIN_B7 
.................... #define ES5   PIN_C7 
.................... #define ES6   PIN_C6 
.................... #define ES7   PIN_C1 
.................... #define ES8   PIN_C0 
....................  
.................... /*********************************************************** 
....................         MACROS PARA LEER LOS SENSORES FIJOS INX 
.................... ***********************************************************/ 
....................  
.................... #define IN1      input(PIN_D0) 
.................... #define IN2      input(PIN_D1) 
.................... #define IN3      input(PIN_D2) 
.................... #define IN4      input(PIN_D3) 
.................... #define IN5      input(PIN_D4) 
.................... //IN6 ES UNA E/S CONFIGURABLE 
.................... //#define IN6      input(ES0) 
.................... //#define IN6      input(ES1) 
.................... // ... O CUALQUIER OTRA E/S DIRECTA 
....................  
.................... /*********************************************************** 
....................             DIRECTIVA PARA EL USO DEL I2C 
.................... ***********************************************************/ 
.................... #use I2C(master, sda=PIN_B0, scl=PIN_B1) 
....................  
.................... #endif 
....................  
....................  
....................  
.................... #use delay (clock=48000000) 
*
08DC:  CLRF   FEA
08DE:  MOVLW  19
08E0:  MOVWF  FE9
08E2:  MOVF   FEF,W
08E4:  BZ    0902
08E6:  MOVLW  0F
08E8:  MOVWF  01
08EA:  CLRF   00
08EC:  DECFSZ 00,F
08EE:  BRA    08EC
08F0:  DECFSZ 01,F
08F2:  BRA    08EA
08F4:  MOVLW  8F
08F6:  MOVWF  00
08F8:  DECFSZ 00,F
08FA:  BRA    08F8
08FC:  NOP   
08FE:  DECFSZ FEF,F
0900:  BRA    08E6
0902:  GOTO   0948 (RETURN)
.................... #define INF_16_BIT 65535 
.................... #define SR04_TRIGG PIN_A4 
.................... #define SR04_ECHO PIN_B3 
....................  
.................... // 50 cm * (59 ms / 1 cm) * (3uds /2ms) = 4425 
....................  
.................... int captura = 0; 
.................... long v_captura; 
....................  
.................... #INT_TIMER1 
.................... void check_time_out(){ 
....................    disable_interrupts(INT_CCP2); 
*
08A2:  BCF    FA0.0
....................    disable_interrupts(INT_TIMER1);          
08A4:  BCF    F9D.0
....................    v_captura = INF_16_BIT; 
08A6:  SETF   18
08A8:  SETF   17
....................    captura = 0; 
08AA:  CLRF   16
.................... } 
....................  
....................  
08AC:  BCF    F9E.0
08AE:  GOTO   0860
.................... #INT_CCP2 
.................... void capture(){ 
....................    if (captura == 0){ 
08B2:  MOVF   16,F
08B4:  BNZ   08C8
....................       set_timer1(0); 
08B6:  CLRF   FCF
08B8:  CLRF   FCE
....................       captura++; 
08BA:  INCF   16,F
....................       enable_interrupts(INT_TIMER1);    
08BC:  BSF    F9D.0
....................       setup_ccp2(CCP_CAPTURE_FE);          
08BE:  BSF    F94.1
08C0:  CLRF   FBA
08C2:  MOVLW  04
08C4:  MOVWF  FBA
....................    } 
08C6:  BRA    08D6
....................    else{ 
....................       v_captura = CCP_2; 
08C8:  MOVFF  FBC,18
08CC:  MOVFF  FBB,17
....................       captura = 0; 
08D0:  CLRF   16
....................       disable_interrupts(INT_CCP2); 
08D2:  BCF    FA0.0
....................       disable_interrupts(INT_TIMER1); 
08D4:  BCF    F9D.0
....................    } 
08D6:  BCF    FA1.0
08D8:  GOTO   0860
.................... } 
....................  
.................... void pulseIn_ECHO_HIGH(){ 
....................    setup_ccp2(CCP_CAPTURE_RE); 
*
0906:  BSF    F94.1
0908:  CLRF   FBA
090A:  MOVLW  05
090C:  MOVWF  FBA
....................    enable_interrupts(INT_CCP2); 
090E:  BSF    FA0.0
....................    setup_timer_1(T1_INTERNAL|T1_DIV_BY_8); 
0910:  MOVLW  B5
0912:  MOVWF  FCD
....................    v_captura = 0; 
0914:  CLRF   18
0916:  CLRF   17
....................    while(v_captura == 0){ 
0918:  MOVF   17,F
091A:  BNZ   0922
091C:  MOVF   18,F
091E:  BNZ   0922
0920:  BRA    0918
....................       //led_on(); 
....................    } 
0922:  GOTO   094E (RETURN)
.................... } 
....................  
.................... void main(){ 
0926:  CLRF   FF8
0928:  BCF    FD0.7
092A:  BSF    07.7
092C:  CLRF   16
092E:  MOVF   FC1,W
0930:  ANDLW  C0
0932:  IORLW  0F
0934:  MOVWF  FC1
0936:  MOVLW  07
0938:  MOVWF  FB4
....................     
....................    enable_interrupts(GLOBAL); 
093A:  MOVLW  C0
093C:  IORWF  FF2,F
....................     
....................    while(1){ 
....................        
....................       output_high(SR04_TRIGG); 
093E:  BCF    F92.4
0940:  BSF    F89.4
....................       delay_ms(15); 
0942:  MOVLW  0F
0944:  MOVWF  19
0946:  BRA    08DC
....................       output_low(SR04_TRIGG); 
0948:  BCF    F92.4
094A:  BCF    F89.4
....................       pulseIn_ECHO_HIGH(); 
094C:  BRA    0906
....................  
....................       if (v_captura < 4425){ 
094E:  MOVF   18,W
0950:  SUBLW  11
0952:  BNC   0962
0954:  BNZ   095C
0956:  MOVF   17,W
0958:  SUBLW  48
095A:  BNC   0962
....................          //cerca 
....................          led_on(); 
095C:  BCF    F92.5
095E:  BSF    F89.5
....................       } 
0960:  BRA    0966
....................       else{ 
....................          //lejos 
....................          led_off(); 
0962:  BCF    F92.5
0964:  BCF    F89.5
....................       } 
0966:  BRA    093E
....................    } 
....................  
.................... } 
....................  
0968:  SLEEP 

Configuration Fuses:
   Word  1: 0E24   PLL5 CPUDIV1 USBDIV HSPLL NOFCMEN NOIESO
   Word  2: 1E3F   NOPUT BROWNOUT BORV21 VREGEN NOWDT WDT32768
   Word  3: 8100   CCP2C1 NOPBADEN NOLPT1OSC MCLR
   Word  4: 0081   STVREN NOLVP ICSP1 NOXINST NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: A00F   NOWRT NOWRTC WRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
