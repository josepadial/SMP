#fuses NOMCLR INTRC_IO
#use delay(clock = 48000000)
#use fast_io(B)
 
int8 check;
unsigned int16 i, distance;
void main(){
  setup_oscillator(OSC_4MHZ);                      // Set internal oscillator to 8MHz
  setup_adc_ports(NO_ANALOGS);
  output_b(0);
  set_tris_b(2);                                   // Configure RB1 as input
  setup_timer_1 (T1_INTERNAL | T1_DIV_BY_2);       // Configure Timer1 module
  set_timer1(0);                                   // Reset Timer1
  for(int i=0;i<3;i++){
      led_on();
      delay_ms(1000);
      led_off();
  }
  while(TRUE){
    check = 0;
    i = 0;
    output_high(PIN_B0);
    delay_us(10);
    output_low(PIN_B0);
    set_timer1(0);                                 // Reset Timer1
    while(!input(PIN_B1) && (get_timer1() < 1000));
    if(get_timer1() > 990)
      check = 1;                                   // Timeout error
    set_timer1(0);                                 // Reset Timer1
    while(input(PIN_B1) && (i < 25000))
      i = get_timer1();                            // Store Timer1 value in i 
    if(i > 24990)                                  // Out of range error
      check = 2;
    if(check == 1){
      for(int i=0;i<3;i++){
         led_on();
         delay_ms(500);
         led_off();
     }
    }
    if(check == 2){
      led_on();
      delay_ms(2000);
      led_off();
    }
    else{
      led_on();
      delay_ms(500);
      led_off();
    }
    delay_ms(100);
  }
}
